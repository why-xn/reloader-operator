apiVersion: reloader.stakater.com/v1alpha1
kind: ReloaderConfig
metadata:
  name: reloader-with-teams-alerts
  namespace: production
spec:
  # Watch all secrets and configmaps referenced by workloads
  autoReloadAll: true

  # Target workloads
  targets:
    - kind: Deployment
      name: payment-service
      reloadStrategy: annotations
      pausePeriod: 5m  # Wait 5 minutes before allowing next reload

    - kind: StatefulSet
      name: redis-cluster
      reloadStrategy: env-vars
      pausePeriod: 10m

  # Alert configuration - Microsoft Teams
  alerts:
    teams:
      # Use secret reference for production
      secretRef:
        name: teams-webhook-secret
        namespace: production  # Optional, defaults to ReloaderConfig namespace
        key: webhook-url
---
# Example secret for storing Teams webhook URL
apiVersion: v1
kind: Secret
metadata:
  name: teams-webhook-secret
  namespace: production
type: Opaque
stringData:
  webhook-url: "https://outlook.office.com/webhook/YOUR/TEAMS/WEBHOOK"
